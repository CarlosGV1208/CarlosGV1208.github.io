{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Food products I usually buy in the supermarket",
    "subtitle": [
      "Mean average monthly price",
      "Source: ONS microdata via Davies"
    ],
    "anchor": "start",
    "fontSize": 20,
    "subtitleFontSize": 14,
    "offset": 20
  },
  "width": 600,
  "height": 400,
  "config": {"view": {"stroke": "transparent"}, "font": "Arial, sans-serif"},
  "layer": [
    {
      "description": "GRÁFICO PRINCIPAL (Líneas de precios)",
      "data": {
        "url": "https://raw.githubusercontent.com/CarlosGV1208/CarlosGV1208.github.io/refs/heads/main/portfolio_cc/cc8/takeaway_price_stats_2005.csv"
      },
      "encoding": {
        "x": {
          "field": "date",
          "type": "temporal",
          "axis": {"title": null, "grid": false, "format": "%Y"}
        },
        "y": {
          "field": "price",
          "type": "quantitative",
          "axis": {"title": "Price (£)", "grid": true}
        },
        "color": {
          "field": "label",
          "type": "nominal",
          "legend": null,
          "scale": {"scheme": "set2"}
        }
      },
      "layer": [
        {"mark": {"type": "line", "interpolate": "monotone", "strokeWidth": 2}},
        {
          "description": "Etiquetas al final de las lineas",
          "transform": [
            {
              "window": [{"op": "rank", "as": "rank_date"}],
              "sort": [{"field": "date", "order": "descending"}],
              "groupby": ["label"]
            },
            {"filter": "datum.rank_date == 1"}
          ],
          "layer": [
            {
              "mark": {
                "type": "point",
                "filled": true,
                "size": 50,
                "opacity": 1
              }
            },
            {
              "mark": {
                "type": "text",
                "align": "left",
                "dx": 8,
                "fontSize": 12,
                "fontWeight": "bold"
              },
              "encoding": {"text": {"field": "label"}}
            }
          ]
        }
      ]
    },
    {
      "description": "CAPA DE EVENTOS (Líneas verticales y texto)",
      "data": {
        "values": [
          {"date": "2008-09-15", "event": "Financial crisis"},
          {"date": "2012-07-27", "event": "London Olimpic games"},
          {"date": "2016-06-23", "event": "Brexit Referendum"},
          {"date": "2020-01-01", "event": "Covid-19"},
          {"date": "2022-02-24", "event": "Ukraine war"},
          {"date": "2024-11-06", "event": "Trump"}
        ]
      },
      "encoding": {"x": {"field": "date", "type": "temporal"}},
      "layer": [
        {
          "mark": {
            "type": "rule",
            "strokeDash": [4, 4],
            "color": "gray",
            "opacity": 0.4,
            "strokeWidth": 1
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "left",
            "baseline": "top",
            "dx": 4,
            "dy": 0,
            "fontSize": 10,
            "color": "#666"
          },
          "encoding": {"text": {"field": "event"}, "y": {"value": 0}}
        }
      ]
    }
  ]
}