{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Financial knowledge by socio-demographic subgroups",
    "subtitle": [
      "Comparison of average financial knowledge scores (out of 100) by socio-demographic subgroups.",
      "Source: OECD/INFE 2023 International Survey."
    ],
    "anchor": "start",
    "fontSize": 18,
    "subtitleFontSize": 13,
    "offset": 25
  },
  "width": 450,
  "height": 500,
  "data": {
    "url": "https://raw.githubusercontent.com/CarlosGV1208/CarlosGV1208.github.io/refs/heads/main/project/p3/p3_long.csv"
  },
  "params": [
    {
      "name": "GapSelect",
      "value": "Gender",
      "bind": {
        "input": "select",
        "options": ["Gender", "Wealth", "Age"],
        "labels": [
          "Gender Gap (Men vs Women)",
          "Wealth Gap (High vs Low Income)",
          "Age Gap (Age 30-59 vs 18-29)"
        ],
        "name": "Select group: "
      }
    }
  ],
  "transform": [
    {
      "filter": "(GapSelect == 'Gender' && (datum.category == 'Gender' || datum.indicator == 'men' || datum.indicator == 'women')) || (GapSelect == 'Wealth' && (datum.category == 'Wealth' || datum.indicator == 'high income' || datum.indicator == 'low income')) || (GapSelect == 'Age' && (datum.category == 'Age' || datum.indicator == 'age 30-59' || datum.indicator == 'age 18-29'))"
    },
    {
      "filter": "!test(/gap/, datum.indicator)"
    },
    {
      "calculate": "(datum.indicator == 'men' && GapSelect == 'Gender') || (datum.indicator == 'high income' && GapSelect == 'Wealth') || (datum.indicator == 'age 30-59' && GapSelect == 'Age') ? datum.value : -1",
      "as": "sort_val"
    },
    {
      "joinaggregate": [
        {"op": "max", "field": "sort_val", "as": "country_order"},
        {"op": "min", "field": "value", "as": "min_val"},
        {"op": "max", "field": "value", "as": "max_val"}
      ],
      "groupby": ["Country"]
    }
  ],
  "layer": [
    {
      "description": "Horizontal connectors (Dumbbell)",
      "mark": {"type": "rule", "color": "#e0e0e0", "size": 2.5},
      "encoding": {
        "y": {
          "field": "Country",
          "type": "nominal",
          "sort": {"field": "country_order", "order": "descending"},
          "axis": {
            "title": null, 
            "labelFontSize": 12,
            "labelFontWeight": {
              "condition": {
                "test": "datum.value == 'Overall Average' || datum.value == 'OECD Average'",
                "value": "bold"
              },
              "value": "normal"
            },
            "labelColor": {
              "condition": {
                "test": "datum.value == 'Overall Average' || datum.value == 'OECD Average'",
                "value": "#d80b0b"
              },
              "value": "black"
            }
          }
        },
        "x": {"field": "min_val", "type": "quantitative"},
        "x2": {"field": "max_val"}
      }
    },
    {
      "description": "Data points",
      "params": [
        {
          "name": "highlight",
          "select": {"type": "point", "fields": ["indicator"]},
          "bind": "legend"
        }
      ],
      "mark": {"type": "point", "size": 140, "filled": true, "opacity": 1},
      "encoding": {
        "y": {
          "field": "Country",
          "type": "nominal",
          "sort": {"field": "country_order", "order": "descending"}
        },
        "x": {
          "field": "value",
          "type": "quantitative",
          "title": "Literacy Score",
          "scale": {"domain": [30, 95]}
        },
        "color": {
          "field": "indicator",
          "type": "nominal",
          "title": null,
          "scale": {
            "scheme": {
              "expr": "GapSelect == 'Gender' ? 'observable10' : GapSelect == 'Wealth' ? 'tableau10' : 'set1'"
            }
          },
          "legend": {
            "orient": "top",
            "direction": "horizontal",
            "symbolType": "circle",
            "offset": 15,
            "labelFontSize": 12,
            "columnPadding": 70
          }
        },
        "opacity": {
          "condition": {"param": "highlight", "value": 1},
          "value": 0.15
        },
        "tooltip": [
          {"field": "Country", "title": "Country"},
          {"field": "indicator", "title": "Group"},
          {"field": "value", "title": "Score", "format": ".1f"}
        ]
      }
    }
  ],
  "config": {
    "view": {"stroke": null},
    "axis": {"grid": true, "gridDash": [2, 2], "gridColor": "#f0f0f0"}
  }
}